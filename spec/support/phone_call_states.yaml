without_voice_prompts:
  - answered:
      finding_new_friends:
        twiml_expectation: no_response
        substates:
          already_in_chat: connecting_user_with_friend
          to_unavailable_user:
            next_state: finding_new_friends
            expectations:
              assertions:
              - message_queued_for_partner
  - finding_new_friends:
      completed:
        twiml_expectation: redirect_to_current_url
        substates:
          found_friends: dialing_friends
  - dialing_friends:
      finding_new_friends:
        twiml_expectation: dial_friends
        substates:
          dial_status_completed: completed
  - connecting_user_with_friend:
      finding_new_friends:
        twiml_expectation: dial_partner
        traits:
        - with_active_chat
  - completed:
      completed:
        twiml_expectation: hangup_current_call
with_voice_prompts:
  - answered:
      welcoming_user:
        twiml_expectation: no_response
  - welcoming_user:
      offering_menu:
        twiml_expectation:
          play_languages: welcome
  - offering_menu:
      finding_new_friends:
        twiml_expectation:
          ask_for_input: offer_menu
        substates:
          caller_wants_menu: asking_for_age_in_menu
          already_in_chat: connecting_user_with_friend
          to_unavailable_user:
            next_state: finding_new_friends
            expectations:
              assertions:
              - message_queued_for_partner
  - asking_for_age_in_menu:
      asking_for_gender_in_menu:
        twiml_expectation:
          ask_for_input:
            ask_for_age:
              numDigits: 2
        substates:
          caller_is_24_years_old:
            next_state: asking_for_gender_in_menu
            expectations:
              user:
                age: 24
  - asking_for_gender_in_menu:
      asking_for_looking_for_in_menu:
        twiml_expectation:
          ask_for_input: ask_for_gender
        substates:
          caller_answers_male:
            next_state: asking_for_looking_for_in_menu
            expectations:
              user:
                gender: m
          caller_answers_female:
            next_state: asking_for_looking_for_in_menu
            expectations:
              user:
                gender: f
  - asking_for_looking_for_in_menu:
      offering_menu:
        twiml_expectation:
          ask_for_input: ask_for_looking_for
        substates:
          caller_answers_male:
            next_state: offering_menu
            expectations:
              user:
                looking_for: m
          caller_answers_female:
            next_state: offering_menu
            expectations:
              user:
                looking_for: f
  - finding_new_friends:
      telling_user_to_try_again_later:
        twiml_expectation: redirect_to_current_url
        substates:
          found_friends: dialing_friends
  - dialing_friends:
      finding_new_friends:
        twiml_expectation: dial_friends
        substates:
          dial_status_completed: telling_user_their_chat_has_ended
  - connecting_user_with_friend:
      finding_new_friend:
        twiml_expectation: dial_partner
        substates:
          dial_status_completed: telling_user_their_chat_has_ended
        traits:
         - with_active_chat
  - telling_user_their_chat_has_ended:
      offering_menu:
        twiml_expectation:
          play_languages: tell_user_their_chat_has_ended
  - telling_user_to_try_again_later:
      completed:
        twiml_expectation:
          play_languages: tell_user_to_try_again_later
  - completed:
      completed:
        twiml_expectation: hangup_current_call
